import{n as s,g as f,s as I,u as P,a as E}from"./utils-DCDllkeh.js";import{P as y}from"./ProductData-lcQ-4hqf.js";const p=u=>`$${Number(u||0).toFixed(2)}`,a="data:image/svg+xml;utf8,"+encodeURIComponent(`<svg xmlns='http://www.w3.org/2000/svg' width='640' height='480' viewBox='0 0 640 480'>
      <rect width='640' height='480' fill='#eee'/>
      <text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle'
            font-family='Arial,Helvetica,sans-serif' font-size='22' fill='#888'>
        No image
      </text>
    </svg>`);class w{constructor(t,e){this.productId=t,this.dataSource=e,this.product=null}async init(){try{this.product=await this.dataSource.findProductById(this.productId)}catch(t){console.error("[ProductDetails] fetch error:",t),this.product=null}if(!this.product){console.warn("[ProductDetails] Product not found:",this.productId),this.renderNotFound();return}this.renderProductDetails(),document.addEventListener("click",t=>{t.target.closest("#addToCart")&&(t.preventDefault(),this.addProductToCart())})}renderNotFound(){const t=document.getElementById("productName");t&&(t.textContent="Product not found");const e=document.getElementById("productImage");e&&(e.src=a);const r=document.getElementById("productDescription");r&&(r.innerHTML="<em>We couldn't load this product.</em>");const n=document.getElementById("productPrice");n&&(n.textContent=p(0))}renderProductDetails(){const t=this.product,e=document.getElementById("productName");e&&(e.textContent=t?.Name??"");const r=document.getElementById("productDescription");r&&(r.innerHTML=t?.DescriptionHtmlSimple??"");const n=t?.FinalPrice??t?.ListPrice??0,o=document.getElementById("productPrice");o&&(o.textContent=p(n));const i=t?.PrimaryLarge||t?.PrimaryMedium||t?.Image||"",d=s(i)||a,c=document.getElementById("productImage");c&&(c.src=d,c.onerror=()=>{c.onerror=null,c.src=a},t?.Name&&(c.alt=t.Name));const h=typeof t?.Brand=="object"?t.Brand?.Name:t?.Brand??"",l=document.getElementById("productBrand");l&&(l.textContent=h);const g=t?.Colors?.[0]?.ColorName??"",m=document.getElementById("productColor");m&&(m.textContent=g)}addProductToCart(){if(!this.product||!this.product.Id&&!this.product.id){alert("Product not loaded");return}const t=f("so-cart")||[],e=String(this.product.Id??this.product.id??this.product.SKU??this.product.Name),r=s(this.product.PrimaryMedium||this.product.PrimaryLarge||this.product.Image||""),n=this.product.FinalPrice??this.product.ListPrice??0,o=t.find(d=>String(d.Id)===e);o?(o.quantity=(Number(o.quantity)||1)+1,!o.Image&&r&&(o.Image=r),!o.FinalPrice&&n&&(o.FinalPrice=n)):t.push({Id:e,Name:this.product.Name??"Unknown",Image:r,FinalPrice:n,quantity:1}),I("so-cart",t),P(),window.dispatchEvent(new Event("cart:updated"));const i=new URL("../cart/index.html",window.location.href);window.location.href=i.href}}const x=E("product"),B=new y("tents"),C=new w(x,B,s);C.init();export{w as P};
